---
title: "Биостатистика. ДЗ №6"
author: "Тарвидс Эдгарс"
date: "2024-04-17"
output: html_document
---
```{r}
# Задаем параметры по условию задачи
alpha = 0.05  # уровень значимости
beta <- 0.20  # вероятность ошибки второго рода (1-power)
power <- 0.80  # мощность исследования
drop_rate <- 0.10  # значение drop-out rate
```


**Задание 1. Расчет размера выборки для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна.**

**Комментарий:** в условии задания есть некоторая неоднозначность - указано 20% дисперсия, а в скобках прописано сигма = 0,20. Не совмес понятно, чем в итоге является 0,20 (дисперсия или ст. отклонение). Соответственно, рассмотрим два варианта решения этой задачи.

**Вариант 1** (сигма = 0,2)

```{r}
sigma <- 0.20  
e <- -0.10  # разность средних
delta <- 0.25  # клинически значимая разница
```

```{r}
up <- (qnorm(1-(alpha/2)) + qnorm(1-beta))^2 * sigma^2  # расчет выражения в числителе
```

```{r}
down <- 2*(delta-abs(e))^2  # расчет выражения в знаменатиле
```

```{r}
n1 = up / down  # расчет размера выборки для одной группы
n1
```

```{r}
n = n1*2  # расчет размера выборки (n1+n2)
```

```{r}
sample_task1 <- ceiling(n / 0.9)  # учет drop-out значения
sample_task1  # размер итоговой выборки
```
**Размер выборки** составляет 16.

**Вариант 2** (сигма^2 = 0.2, то есть дисперсия)

```{r}
sigma <- 0.20  
e <- -0.10  # разность средних
delta <- 0.25  # клинически значимая разница
```

```{r}
up_1 <- (qnorm(1-(alpha/2)) + qnorm(1-beta))^2 * sigma  # расчет выражения в числителе
```

```{r}
down_1 <- 2*(delta-abs(e))^2  # расчет выражения в знаменатиле
```

```{r}
n1_1 = up_1 / down_1  # расчет размера выборки для одной группы
n1_1
```

```{r}
n_f = n1_1*2  # расчет размера выборки (n1+n2)
```

```{r}
sample_task1_1 <- ceiling(n_f / 0.9)  # # расчет размер выборки, включающей 2 подгруппы с учетом drop-out
sample_task1_1  # размер итоговой выборки
```
**Размер выборки** составляет 78.

**Задание 2. Рассчет выборки для гипотезы non-inferiority для двухвыборочного параллельного дизайна.**

```{r}
k <- 1  # соотношение групп
delta <- -0.1  # клинически значимая разница
p1 <- 0.85  # доля ответов у препарата сравнения
p2 <- 0.65  # доля ответов у тестового препарата

```

```{r}
up_2 <- (qnorm(1-(alpha/2)) + qnorm(1-beta))^2*(p1*(1-p1)+p2*(1-p2))  # расчет числителя
```

```{r}
down_2 <- (p1-p2-delta)^2  # расчет знаменателя
```

```{r}
n_1 = up_2 / down_2  # расчет одной подгруппы в выборке
n_1
```

```{r}
n_2 <- n_1 * k  # расчет размера второй подгруппы с учетом соотношения (1:1)
n_2
```

```{r}
sample_task2 <- ceiling((n_1*2)/0.9)  # расчет размер выборки, включающей 2 подгруппы с учетом drop-out
sample_task2
```

**Размер выборки** составляет 69. Чтобы в группе было равное целочисленное количество испытуемых необходимо увеличить рассчитанное значение на 1, то есть 70 человек. Менее 69, например, 68, брать нельзя, так как протеворечит расчету, а больший объем выборки наоборот приветствуется.


**Задание 3. Рассчет выборки для гипотезы equality для следующего исследования.**

```{r}
HR = 2  # соотношение рисков
d = 0.8  # доля пациентов с заболеванием
p3 = 0.5
p4 = 0.5
loghr <- log(HR)  # расчет натурального логарифма от соотношения рисков
```

```{r}
up_3 <- (qnorm(1-(alpha/2))+qnorm(1-beta))^2  # расчет числителя
```

```{r}
down_3 <- loghr^2*p3*p4*d  # расчет знаменателя
```

```{r}
n3 <- up_3 / down_3  # вычисление размера одной подгруппы в выборке
```

```{r}
sample_task3 <- ceiling((n3*2)/0.9)  # расчет размер выборки, включающей 2 подгруппы с учетом drop-out
sample_task3
```

**Размер выборки** составляет 182.